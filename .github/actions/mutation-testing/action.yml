name: Mutation Testing üßü‚Äç‚ôÇÔ∏è
description: Evaluate the quality of existing tests
runs:
  using: composite
  steps:
    - name: Install cargo-mutants üß∞
      uses: taiki-e/install-action@v2
      with:
        tool: cargo-mutants

    - name: Generate git.diff üß∞
      if: github.event.pull_request.head.ref == 'main'
      shell: pwsh
      run: git diff origin/${{ github.event.pull_request.base.ref }}..origin/${{ github.event.pull_request.head.ref }} > git.diff

    - name: Run cargo-mutants üßü‚Äç‚ôÇÔ∏è
      id: run-cargo-mutants
      shell: pwsh
      run: |
        if ('${{ github.event.pull_request.head.ref }}' -eq 'main') {
          cargo mutants --all-features --no-shuffle --in-place --test-workspace=true
        } else {
          cargo mutants --all-features --no-shuffle --in-place --test-workspace=true --in-diff git.diff
        }

    - name: Archive results ‚¨ÜÔ∏è
      uses: actions/upload-artifact@v4
      if: steps.run-cargo-mutants.outcome == 'failure'
      with:
        name: mutation-testing-report
        path: mutants.out