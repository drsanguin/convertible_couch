name: Pull Request

on:
  pull_request:
    branches: [ "main", "develop" ]

env:
  CARGO_TERM_COLOR: always

jobs:
  ci:
    name: CI
    runs-on: windows-latest

    steps:
    - name: Checkout repository â¬‡ï¸
      uses: actions/checkout@v4
      with:
        submodules: true

    - name: Check coding style ğŸ“
      run: cargo fmt --check --all

    - uses: ./.github/actions/setup-windows-dev-environment

    - name: Compile ğŸ—ï¸
      run: cargo build --all-targets --verbose

    - name: Run Tests ğŸ§ª
      run: cargo test --verbose -- --nocapture
      
    - name: Install cargo-mutants ğŸ§°
      run: cargo install --locked cargo-mutants

    - name: Run Mutants Tests ğŸ§Ÿâ€â™‚ï¸
      id: run_mutants_tests
      run: cargo mutants --all-features --no-shuffle --in-place --test-workspace=true

    - name: Archive results â¬†ï¸
      uses: actions/upload-artifact@v4
      if: steps.run_mutants_tests.outcome == 'failure'
      with:
        name: mutation-report
        path: mutants.out
        
    - name: Run Benchmarks â±ï¸
      run: cargo test --benches

    - uses: ./.github/actions/coverage